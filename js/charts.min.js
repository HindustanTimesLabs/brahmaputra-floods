$(document).ready(function(){function a(a){var b=$(window).width();return"2012"==a?a=b<992?"'12":a:"2013"==a?a=b<992?"'13":a:"2014"==a?a=b<992?"'14":a:"2015"==a?a=b<992?"'15":a:"2016"==a&&(a=b<992?"'16":a),a}function b(a){return a<420?1:2}function c(a){if($(window).width()>768){var b=typeof a;"number"==b?a=a.toString():"string"==b&&(a=a.replace(/,/g,""));var c=a.substring(a.length-3),d=a.substring(0,a.length-3);""!=d&&(c=","+c);var e=d.replace(/\B(?=(\d{2})+(?!\d))/g,",")+c;return e}return a}function B(d,B){function D(a){var b={};return"villages"==a?(b.metric="villages affected",b.metricSingular="village affected",b.ySize=".8em"):"people"==a?(b.metric="people affected",b.metricSingular="person affected",b.ySize=".5em"):"campsPeople"==a?(b.metric="people in relief camps",b.metricSingular="person in relief camps",b.ySize=".6em"):"deceased"==a?(b.metric="people killed",b.metricSingular="person killed",b.ySize=".8em"):"cropArea"==a&&(b.metric="hectares affected",b.metricSingular="hectare affected",b.ySize=".6em"),b}var D=D(d),E=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(a){var b;return b=1==a[d]?D.metricSingular:D.metric,"<strong>"+a.dateString+"</strong><br /><br /><span style='color:#2980b9;font-weight:900'>"+c(a[d])+"</span> "+b});w.call(E),x.call(E),y.call(E),z.call(E),A.call(E),d3.csv("data/flooddata_julyStart.csv",C,function(C,F){var G=[],H=[],I=[],J=[],K=[];if(F.forEach(function(a,b){"2012"==a.year?G.push(a):"2013"==a.year?H.push(a):"2014"==a.year?I.push(a):"2015"==a.year?J.push(a):"2016"==a.year&&K.push(a)}),l.domain([0,d3.max(F,function(a){return a[d]})]),r.tickValues([0,d3.max(G,function(a){return a[d]})]),g.domain([new Date("July 1, 2012"),new Date("October 1, 2012")]),w.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(m),$("#chart_2012 .y.axis").remove(),$("#chart-year-2012").remove(),w.append("g").attr("class","y axis").call(r).append("text").attr("class","chart-year").attr("id","chart-year-2012").attr("y",f+9).attr("dy",".71em").attr("x",3).style("text-anchor","start").style("stroke-width",1).text(a("2012")),$(window).width()>768){var L=c($("#chart_2012 .y.axis .tick:nth-of-type(2) text").html());$("#chart_2012 .y.axis .tick:nth-of-type(2) text").html(L)}var M=w.selectAll(".bar-area").data(G);M.enter().append("rect").attr("class","bar-area").attr("area-id",function(a,b){return"2012"+b}),M.exit().on("mouseover",function(a,b){E.show(a);var c=[0,0];c=d3.mouse(this);var d=c[1],e=$(this).offset().top-80;$(".d3-tip").css("top",e+d-3),$(".barId2012"+b).css("fill","#2c3e50")}).on("mouseout",function(a,b){E.hide(a),$(".barId2012"+b).css("fill","#2980b9")}).transition().duration(300).ease("quad-out").attr("height",0).remove(),M.attr("x",function(a){return g(a.date)}).attr("width",function(a){return e/G.length+1}).attr("y",0).on("mouseover",function(a,b){E.show(a);var c=[0,0];c=d3.mouse(this);var d=c[1],e=$(this).offset().top-80;$(".d3-tip").css("top",e+d-3),$(".barId2012"+b).css("fill","#2c3e50")}).on("mouseout",function(a,b){E.hide(a),$(".barId2012"+b).css("fill","#2980b9")}).transition().duration(300).ease("quad-out").attr("height",f);var N=w.selectAll(".bar").data(G);N.enter().append("rect").attr("class",function(a,b){return"bar barId2012"+b}).attr("x",function(a){return g(a.date)}).attr("width",function(a){return e/G.length-b($(window).width())}),N.exit().transition().duration(300).ease("quad-out").attr("y",0).attr("height",0).remove(),N.on("mouseover",function(a,b){E.show(a);var c=[0,0];c=d3.mouse(this);var d=f-$(this).attr("height"),e=c[1],g=$(this).offset().top-80-d;$(".d3-tip").css("top",g+e-3),$(".barId2012"+b).css("fill","#2c3e50")}).on("mouseout",function(a,b){E.hide(a),$(".barId2012"+b).css("fill","#2980b9")}).transition().duration(300).ease("quad-out").attr("y",function(a){return l(a[d])}).attr("height",function(a){return f-l(a[d])});var O=d3.max(G,function(a){return a[d]});if($("#chart_2012 .bar-text").remove(),setTimeout(function(){w.selectAll(".bar-text").data(G).enter().append("text").attr("text-anchor","middle").attr("class",function(a){return a[d]==O?"bar-text text-max":"bar-text"}).attr("y",function(a){return l(a[d])-2}).attr("x",function(a){var b=g(a.date);return b<30?30:g(a.date)}).text(function(a){return a[d]==O&&"Sep. 28"!=a.dateStringShort&&"Sep. 29"!=a.dateStringShort?"High: "+a.dateStringShort:""})},300),$("#g-2012").append($("text#chart-year-2012")),s.tickValues([0,d3.max(H,function(a){return a[d]})]),h.domain([new Date("July 1, 2013"),new Date("October 1, 2013")]),x.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(n),$("#chart_2013 .y.axis").remove(),$("#chart-year-2013").remove(),x.append("g").attr("class","y axis").call(s).append("text").attr("class","chart-year").attr("id","chart-year-2013").attr("y",f+9).attr("dy",".71em").attr("x",3).style("text-anchor","start").text(a("2013")),$(window).width()>768){var P=c($("#chart_2013 .y.axis .tick:nth-of-type(2) text").html());$("#chart_2013 .y.axis .tick:nth-of-type(2) text").html(P)}var Q=x.selectAll(".bar-area").data(H);Q.enter().append("rect").attr("class","bar-area").attr("area-id",function(a,b){return"2013"+b}),Q.exit().on("mouseover",function(a,b){E.show(a);var c=[0,0];c=d3.mouse(this);var d=c[1],e=$(this).offset().top-80;$(".d3-tip").css("top",e+d-3),$(".barId2013"+b).css("fill","#2c3e50")}).on("mouseout",function(a,b){E.hide(a),$(".barId2013"+b).css("fill","#2980b9")}).transition().duration(300).ease("quad-out").attr("height",0).remove(),Q.attr("x",function(a){return h(a.date)}).attr("width",function(a){return e/H.length+1}).attr("y",0).on("mouseover",function(a,b){E.show(a);var c=[0,0];c=d3.mouse(this);var d=c[1],e=$(this).offset().top-80;$(".d3-tip").css("top",e+d-3),$(".barId2013"+b).css("fill","#2c3e50")}).on("mouseout",function(a,b){E.hide(a),$(".barId2013"+b).css("fill","#2980b9")}).transition().duration(300).ease("quad-out").attr("height",f);var R=x.selectAll(".bar").data(H);R.enter().append("rect").attr("class",function(a,b){return"bar barId2013"+b}).attr("x",function(a){return h(a.date)}).attr("width",function(a){return e/H.length-b($(window).width())}),R.exit().transition().duration(300).ease("quad-out").attr("y",0).attr("height",0).remove(),R.on("mouseover",function(a,b){E.show(a);var c=[0,0];c=d3.mouse(this);var d=f-$(this).attr("height"),e=c[1],g=$(this).offset().top-80-d;$(".d3-tip").css("top",g+e-3),$(".barId2013"+b).css("fill","#2c3e50")}).on("mouseout",function(a,b){E.hide(a),$(".barId2013"+b).css("fill","#2980b9")}).transition().duration(300).ease("quad-out").attr("y",function(a){return l(a[d])}).attr("height",function(a){return f-l(a[d])});var S=d3.max(H,function(a){return a[d]});if($("#chart_2013 .bar-text").remove(),setTimeout(function(){x.selectAll(".bar-text").data(H).enter().append("text").attr("text-anchor","middle").attr("class",function(a){return a[d]==S?"bar-text text-max":"bar-text"}).attr("y",function(a){return l(a[d])-2}).attr("x",function(a){var b=h(a.date);return b<30?30:h(a.date)}).text(function(a){return a[d]==S?"High: "+a.dateStringShort:""})},300),$("#g-2013").append($("text#chart-year-2013")),t.tickValues([0,d3.max(I,function(a){return a[d]})]),i.domain([new Date("July 1, 2014"),new Date("October 1, 2014")]),y.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(o),$("#chart_2014 .y.axis").remove(),$("#chart-year-2014").remove(),y.append("g").attr("class","y axis").call(t).append("text").attr("class","chart-year").attr("id","chart-year-2014").attr("y",f+9).attr("dy",".71em").attr("x",3).style("text-anchor","start").text(a("2014")),$(window).width()>768){var T=c($("#chart_2014 .y.axis .tick:nth-of-type(2) text").html());$("#chart_2014 .y.axis .tick:nth-of-type(2) text").html(T)}var U=y.selectAll(".bar-area").data(I);U.enter().append("rect").attr("class","bar-area").attr("area-id",function(a,b){return"2014"+b}),U.exit().on("mouseover",function(a,b){E.show(a);var c=[0,0];c=d3.mouse(this);var d=c[1],e=$(this).offset().top-80;$(".d3-tip").css("top",e+d-3),$(".barId2014"+b).css("fill","#2c3e50")}).on("mouseout",function(a,b){E.hide(a),$(".barId2014"+b).css("fill","#2980b9")}).transition().duration(300).ease("quad-out").attr("height",0).remove(),U.attr("x",function(a){return i(a.date)}).attr("width",function(a){return e/I.length+1}).attr("y",0).on("mouseover",function(a,b){E.show(a);var c=[0,0];c=d3.mouse(this);var d=c[1],e=$(this).offset().top-80;$(".d3-tip").css("top",e+d-3),$(".barId2014"+b).css("fill","#2c3e50")}).on("mouseout",function(a,b){E.hide(a),$(".barId2014"+b).css("fill","#2980b9")}).transition().duration(300).ease("quad-out").attr("height",f);var V=y.selectAll(".bar").data(I);V.enter().append("rect").attr("class",function(a,b){return"bar barId2014"+b}).attr("x",function(a){return i(a.date)}).attr("width",function(a){return e/I.length-b($(window).width())}),V.exit().transition().duration(300).ease("quad-out").attr("y",0).attr("height",0).remove(),V.on("mouseover",function(a,b){E.show(a);var c=[0,0];c=d3.mouse(this);var d=f-$(this).attr("height"),e=c[1],g=$(this).offset().top-80-d;$(".d3-tip").css("top",g+e-3),$(".barId2014"+b).css("fill","#2c3e50")}).on("mouseout",function(a,b){E.hide(a),$(".barId2014"+b).css("fill","#2980b9")}).transition().duration(300).ease("quad-out").attr("y",function(a){return l(a[d])}).attr("height",function(a){return f-l(a[d])});var W=d3.max(I,function(a){return a[d]});if($("#chart_2014 .bar-text").remove(),setTimeout(function(){y.selectAll(".bar-text").data(I).enter().append("text").attr("text-anchor","middle").attr("class",function(a){return a[d]==W?"bar-text text-max":"bar-text"}).attr("y",function(a){return l(a[d])-2}).attr("x",function(a){var b=i(a.date);return b<30?30:i(a.date)}).text(function(a){return a[d]==W?"High: "+a.dateStringShort:""})},300),$("#g-2014").append($("text#chart-year-2014")),u.tickValues([0,d3.max(J,function(a){return a[d]})]),j.domain([new Date("July 1, 2015"),new Date("October 1, 2015")]),z.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(p),$("#chart_2015 .y.axis").remove(),$("#chart-year-2015").remove(),z.append("g").attr("class","y axis").call(u).append("text").attr("class","chart-year").attr("id","chart-year-2015").attr("y",f+9).attr("dy",".71em").attr("x",3).style("text-anchor","start").text(a("2015")),$(window).width()>768){var X=c($("#chart_2015 .y.axis .tick:nth-of-type(2) text").html());$("#chart_2015 .y.axis .tick:nth-of-type(2) text").html(X)}var Y=z.selectAll(".bar-area").data(J);Y.enter().append("rect").attr("class","bar-area").attr("area-id",function(a,b){return"2015"+b}),Y.exit().on("mouseover",function(a,b){E.show(a);var c=[0,0];c=d3.mouse(this);var d=c[1],e=$(this).offset().top-80;$(".d3-tip").css("top",e+d-3),$(".barId2015"+b).css("fill","#2c3e50")}).on("mouseout",function(a,b){E.hide(a),$(".barId2015"+b).css("fill","#2980b9")}).transition().duration(300).ease("quad-out").attr("height",0).remove(),Y.attr("x",function(a){return j(a.date)}).attr("width",function(a){return e/J.length+1}).attr("y",0).on("mouseover",function(a,b){E.show(a);var c=[0,0];c=d3.mouse(this);var d=c[1],e=$(this).offset().top-80;$(".d3-tip").css("top",e+d-3),$(".barId2015"+b).css("fill","#2c3e50")}).on("mouseout",function(a,b){E.hide(a),$(".barId2015"+b).css("fill","#2980b9")}).transition().duration(300).ease("quad-out").attr("height",f);var Z=z.selectAll(".bar").data(J);Z.enter().append("rect").attr("class",function(a,b){return"bar barId2015"+b}).attr("x",function(a){return j(a.date)}).attr("width",function(a){return e/J.length-b($(window).width())}),Z.exit().transition().duration(300).ease("quad-out").attr("y",0).attr("height",0).remove(),Z.on("mouseover",function(a,b){E.show(a);var c=[0,0];c=d3.mouse(this);var d=f-$(this).attr("height"),e=c[1],g=$(this).offset().top-80-d;$(".d3-tip").css("top",g+e-3),$(".barId2015"+b).css("fill","#2c3e50")}).on("mouseout",function(a,b){E.hide(a),$(".barId2015"+b).css("fill","#2980b9")}).transition().duration(300).ease("quad-out").attr("y",function(a){return l(a[d])}).attr("height",function(a){return f-l(a[d])});var _=d3.max(J,function(a){return a[d]});if($("#chart_2015 .bar-text").remove(),setTimeout(function(){z.selectAll(".bar-text").data(J).enter().append("text").attr("text-anchor","middle").attr("class",function(a){return a[d]==_?"bar-text text-max":"bar-text"}).attr("y",function(a){return l(a[d])-2}).attr("x",function(a){var b=j(a.date);return b<30?30:j(a.date)}).text(function(a){return a[d]==_&&"Sep. 4"!=a.dateStringShort?"High: "+a.dateStringShort:""})},300),$("#g-2015").append($("text#chart-year-2015")),v.tickValues([0,d3.max(K,function(a){return a[d]})]),k.domain([new Date("July 1, 2016"),new Date("October 1, 2016")]),$(".x.axis .tick text").remove(),A.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(q),$("#chart_2016 .y.axis").remove(),$("#chart-year-2016").remove(),A.append("g").attr("class","y axis").call(v).append("text").attr("class","chart-year").attr("id","chart-year-2016").attr("y",f+9).attr("dy",".71em").attr("x",3).style("text-anchor","start").text(a("2016")),$(window).width()>768){var aa=c($("#chart_2016 .y.axis .tick:nth-of-type(2) text").html());$("#chart_2016 .y.axis .tick:nth-of-type(2) text").html(aa)}var ba=A.selectAll(".bar-area").data(K);ba.enter().append("rect").attr("class","bar-area").attr("area-id",function(a,b){return"2016"+b}),ba.exit().on("mouseover",function(a,b){E.show(a);var c=[0,0];c=d3.mouse(this);var d=c[1],e=$(this).offset().top-80;$(".d3-tip").css("top",e+d-3),$(".barId2016"+b).css("fill","#2c3e50")}).on("mouseout",function(a,b){E.hide(a),$(".barId2016"+b).css("fill","#2980b9")}).transition().duration(300).ease("quad-out").attr("height",0).remove(),ba.attr("x",function(a){return k(a.date)}).attr("width",function(a){return e/K.length+1}).attr("y",0).on("mouseover",function(a,b){E.show(a);var c=[0,0];c=d3.mouse(this);var d=c[1],e=$(this).offset().top-80;$(".d3-tip").css("top",e+d-3),$(".barId2016"+b).css("fill","#2c3e50")}).on("mouseout",function(a,b){E.hide(a),$(".barId2016"+b).css("fill","#2980b9")}).transition().duration(300).ease("quad-out").attr("height",f);var ca=A.selectAll(".bar").data(K);ca.enter().append("rect").attr("class",function(a,b){return"bar barId2016"+b}).attr("x",function(a){return k(a.date)}).attr("width",function(a){return e/K.length-b($(window).width())}),ca.exit().transition().duration(300).ease("quad-out").attr("y",0).attr("height",0).remove(),ca.on("mouseover",function(a,b){E.show(a);var c=[0,0];c=d3.mouse(this);var d=f-$(this).attr("height"),e=c[1],g=$(this).offset().top-80-d;$(".d3-tip").css("top",g+e-3),$(".barId2016"+b).css("fill","#2c3e50")}).on("mouseout",function(a,b){E.hide(a),$(".barId2016"+b).css("fill","#2980b9")}).transition().duration(300).ease("quad-out").attr("y",function(a){return l(a[d])}).attr("height",function(a){return f-l(a[d])});var da=d3.max(K,function(a){return a[d]});$("#chart_2016 .bar-text").remove(),setTimeout(function(){A.selectAll(".bar-text").data(K).enter().append("text").attr("text-anchor","middle").attr("class",function(a){return a[d]==da?"bar-text text-max":"bar-text"}).attr("y",function(a){return l(a[d])-2}).attr("x",function(a){var b=k(a.date);return b<30?30:k(a.date)}).text(function(a){return a[d]==da?"High: "+a.dateStringShort:""})},300),$("#g-2016").append($("text#chart-year-2016")),$(".x.axis .tick text").attr("x",$(".chart").width()/6-13),$(".y.axis").css("font-size",D.ySize),"first"==B?$(".y.axis path").css("stroke-width",1.01):$(".y.axis path").css("stroke-width",1)})}function C(a){return a.cropArea=+a.cropArea,a.camps=+a.camps,a.campsPeople=+a.campsPeople,a.villages=+a.villages,a.deceased=+a.deceased,a.districts=+a.districts,a.people=+a.people,a.dateMoment=moment(a.date),a.date=a.dateMoment._d,a.dateString=a.month+" "+a.day+", "+a.year,a.dateStringShort=a.dateMoment.format("MMM. D"),a}var d={top:13,right:40,bottom:30,left:50},e=$(".chart").width()-d.left-d.right,f=$(".chart").height()-d.top-d.bottom,g=d3.time.scale().range([0,e]),h=d3.time.scale().range([0,e]),i=d3.time.scale().range([0,e]),j=d3.time.scale().range([0,e]),k=d3.time.scale().range([0,e]),l=d3.scale.linear().range([f,0]),m=d3.svg.axis().scale(g).orient("bottom").ticks(d3.time.months),n=d3.svg.axis().scale(h).orient("bottom").ticks(d3.time.months),o=d3.svg.axis().scale(i).orient("bottom").ticks(d3.time.months),p=d3.svg.axis().scale(j).orient("bottom").ticks(d3.time.months),q=d3.svg.axis().scale(k).orient("bottom").ticks(d3.time.months),r=d3.svg.axis().scale(l).orient("left"),s=d3.svg.axis().scale(l).orient("left"),t=d3.svg.axis().scale(l).orient("left"),u=d3.svg.axis().scale(l).orient("left"),v=d3.svg.axis().scale(l).orient("left"),w=d3.select("#chart_2012").append("svg").attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom).append("g").attr("id","g-2012").attr("transform","translate("+d.left+","+d.top+")"),x=d3.select("#chart_2013").append("svg").attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom).append("g").attr("id","g-2013").attr("transform","translate("+d.left+","+d.top+")"),y=d3.select("#chart_2014").append("svg").attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom).append("g").attr("id","g-2014").attr("transform","translate("+d.left+","+d.top+")"),z=d3.select("#chart_2015").append("svg").attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom).append("g").attr("id","g-2015").attr("transform","translate("+d.left+","+d.top+")"),A=d3.select("#chart_2016").append("svg").attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom).append("g").attr("id","g-2016").attr("transform","translate("+d.left+","+d.top+")");B("villages","first"),$("#chart-filter").change(function(){B($(this).val(),"notfirst")})});
